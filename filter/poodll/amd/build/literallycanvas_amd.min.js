define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/react_amd","filter_poodll/literallycanvas"],function(a,b,c,d,e){"use strict";return b.debug("Filter PoodLL: literallycanvas.js initialising"),{loadliterallycanvas:function(b){var d="#amdopts_"+b.recorderid,f=a(d).get(0);f&&(b=JSON.parse(f.value),a(d).remove()),c.whiteboardopts[b.recorderid]=b;var g=a("#"+b.recorderid+"_literally")[0];if(b.backgroundimage){var h=a("#"+b.recorderid+"_separate-background-image")[0],i=new Image;i.src=h.src,i.crossOrigin="Anonymous";var j=e.createShape("Image",{x:0,y:0,image:i,scale:1}),k=e.init(g,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,backgroundShapes:[j],recorderid:b.recorderid})}else var k=e.init(g,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,recorderid:b.recorderid});var l=c.whiteboardopts[b.recorderid].vectordata;l&&(0==l.indexOf('{"shapes"')||0==l.indexOf('{"colors"'))&&k.loadSnapshot(JSON.parse(l)),b.autosave?k.on("drawingChange",function(b,d){return function(){var b=a("#"+d+"_messages")[0],e=a("#"+d+"_btn_upload_whiteboard")[0];if(b){e&&(e.disabled=!1),b.innerHTML="";var f=c.timeouthandles[d];f&&clearTimeout(f),c.timeouthandles[d]=setTimeout(function(){c.WhiteboardUploadHandler(d)},c.whiteboardopts[d].autosave)}}}(this,b.recorderid)):k.on("drawingChange",function(b,c){return function(){var b=a("#"+c+"_messages");b&&(b.innerHTML="File has not been saved.")}}(this,b.recorderid)),c.whiteboards[b.recorderid]=k;var m="#"+b.recorderid+"_btn_upload_whiteboard",n=a(m);n&&(b.autosave?n.click(function(){c.WhiteboardUploadHandler(b.recorderid)},!1):n.click(function(){c.CallFileUpload(b.recorderid)},!1))}}});