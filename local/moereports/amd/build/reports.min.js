define(["local_moereports/handsontable","jquery","core/ajax"],function(a,b,c){var d=function(){};return d.prototype.init=function(d){var e=new Array;emptyValidator=function(a,b){b(""===a||null===a||" "===a||a===!1?!1:!0)},rowErased=function(a){var b,c=f.countCols();if(!(a.length>3&&a.length%4===0))return!1;for(var d=0;d<a.length;d++)if(""!==a[d][3])return!1;return b={start:a[0][0],times:a.length/c}},eraseEmptyRows=function(){var a=f.countRows();f.minSpareRows=0;for(var b=0;b<a;b++)f.isEmptyRow(b)&&(f.alter("remove_row",b),b--,a--)};var f=new a(b("#reportstable")[0],{data:d,rowHeaders:!0,colHeaders:["ID",M.util.get_string("symbol","local_moereports"),M.util.get_string("region","local_moereports"),M.util.get_string("name","local_moereports"),M.util.get_string("city","local_moereports")],contextMenu:!0,columns:[{type:"numeric",readOnly:!0},{type:"numeric",validator:emptyValidator},{type:"text",validator:emptyValidator},{type:"text",validator:emptyValidator},{type:"text",validator:emptyValidator}],beforeChange:function(a,b){var c=rowErased(a);if(c){for(var d=0;d<c.times;d++)f.alter("remove_row",c.start);return!1}f.validateCells(function(a){})},afterChange:function(a,b){this.countEmptyRows(!0)<1&&this.alter("insert_row")},beforeRemoveRow:function(a,b){f.getData()[a][0]&&e.push(f.getData()[a][0])}});b("#savereporttable").click(function(a){eraseEmptyRows(),f.validateCells(function(a){if(a){var b=c.call([{methodname:"local_moereports_saveschools",args:{schools:f.getData(),del:e}}]);b[0].done(function(a){f.loadData(a)}).fail(function(a){console.log(a)})}else alert("NO!")})}),b('[name="resetall"]').click(function(){b(this).closest("form").find("input[type='text'], textarea").val("")})},new d});