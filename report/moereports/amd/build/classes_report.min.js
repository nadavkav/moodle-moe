define(["report_moereports/handsontable","jquery","core/ajax","core/notification"],function(a,b,c,d){var e=function(){};return e.prototype.init=function(e,f){var g=[],h=function(a,b){b(""===a||null===a||" "===a||a===!1?!1:!0)},i=function(a){var b,c=k.countCols();if(!(a.length>2&&a.length%3===0))return!1;for(var d=0;d<a.length;d++)if(""!==a[d][3])return!1;return b={start:a[0][0],times:a.length/c}},j=function(){var a=k.countRows();k.minSpareRows=0;for(var b=0;a>b;b++)k.isEmptyRow(b)&&(k.alter("remove_row",b),b--,a--)},k=new a(b("#reportstable")[0],{data:e,rowHeaders:!0,colHeaders:["ID",M.util.get_string("symbol","report_moereports"),M.util.get_string("class","report_moereports"),M.util.get_string("studentsnumber","report_moereports")],contextMenu:!0,columns:[{type:"numeric",readOnly:!0},{type:"autocomplete",source:f,strict:!0},{type:"numeric",validator:h},{type:"numeric",validator:h}],beforeChange:function(a){var b=i(a);if(b){for(var c=0;c<b.times;c++)k.alter("remove_row",b.start);return!1}},afterChange:function(){this.countEmptyRows(!0)<1&&this.alter("insert_row")},beforeRemoveRow:function(a){k.getData()[a][0]&&g.push(k.getData()[a][0])}});b("#savereporttable").click(function(){j(),k.validateCells(function(a){if(a){var b=c.call([{methodname:"report_moereports_classes",args:{classes:k.getData(),del:g}}]);b[0].done(function(a){k.loadData(a)})}else d.addNotification({message:M.util.get_string("changesnotsave","report_moereports"),type:"error"})})}),b('[name="resetall"]').click(function(){b(this).closest("form").find("input[type='text'], textarea").val("")})},new e});