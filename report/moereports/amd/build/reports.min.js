define(["report_moereports/handsontable","jquery","core/ajax","core/notification"],function(a,b,c,d){var e=function(){};return e.prototype.init=function(e){var f=[],g=function(a,b){b(""===a||null===a||" "===a||a===!1?!1:!0)},h=function(a){var b,c=j.countCols();if(!(a.length>3&&a.length%4===0))return!1;for(var d=0;d<a.length;d++)if(""!==a[d][3])return!1;return b={start:a[0][0],times:a.length/c}},i=function(){var a=j.countRows();j.minSpareRows=0;for(var b=0;a>b;b++)j.isEmptyRow(b)&&(j.alter("remove_row",b),b--,a--)},j=new a(b("#reportstable")[0],{data:e,rowHeaders:!0,colHeaders:["ID",M.util.get_string("symbol","report_moereports"),M.util.get_string("region","report_moereports"),M.util.get_string("name","report_moereports"),M.util.get_string("city","report_moereports")],contextMenu:!0,columns:[{type:"numeric",readOnly:!0},{type:"numeric",validator:g},{type:"text",validator:g},{type:"text",validator:g},{type:"text",validator:g}],beforeChange:function(a){var b=h(a);if(b){for(var c=0;c<b.times;c++)j.alter("remove_row",b.start);return!1}},afterChange:function(){this.countEmptyRows(!0)<1&&this.alter("insert_row")},beforeRemoveRow:function(a){j.getData()[a][0]&&f.push(j.getData()[a][0])}});b("#savereporttable").click(function(){i(),j.validateCells(function(a){if(a){var b=c.call([{methodname:"report_moereports_saveschools",args:{schools:j.getData(),del:f}}]);b[0].done(function(a){j.loadData(a)})}else d.addNotification({message:M.util.get_string("changesnotsave","report_moereports"),type:"error"})})}),b('[name="resetall"]').click(function(){b(this).closest("form").find("input[type='text'], textarea").val("")})},new e});